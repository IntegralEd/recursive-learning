<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Chat Directory</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }
        .client-list {
            margin-top: 20px;
        }
        .client-item {
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ RAG Chat Assistant Directory</h1>
        
        <div class="warning">
            <h3>‚ö†Ô∏è Direct Access Not Supported</h3>
            <p>This appears to be a direct access to the RAG Chat system. The chat assistant should be accessed through your organization's Softr application with proper authentication and context.</p>
        </div>

        <h2>Active Client Instances</h2>
        <div class="client-list">
            <div class="client-item">
                <h3>Baltimore Maternal Health</h3>
                <p>Production: <code>bmore.softr.app</code></p>
            </div>
            <!-- Additional clients will be added here -->
        </div>

        <h2>For Developers</h2>
        <p>If you're a developer looking to implement the RAG Chat Assistant:</p>
        <ol>
            <li>Visit our <a href="https://github.com/integraled/rag-chat">GitHub repository</a> for documentation</li>
            <li>Check out the client-specific branches for implementation details</li>
            <li>Contact the development team for API keys and access</li>
        </ol>

        <h2>Support</h2>
        <p>For support or questions about implementing RAG Chat in your organization, please contact:</p>
        <p><code>support@integral-ed.com</code></p>
    </div>

    <div id="chat-app"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Function to parse query parameters
            function getQueryParams() {
                const params = new URLSearchParams(window.location.search);
                return {
                    User_ID: params.get('User_ID') || 'anonymous',
                    Thread_ID: params.get('Thread_ID') || '----',
                    Action_ID: params.get('Action_ID') || '',
                    Org_ID: params.get('Org_ID') || '',
                    source: params.get('source') || ''
                };
            }

            // Retrieve user data from query parameters
            const userData = getQueryParams();
            console.log('User Data:', userData);

            // Mapping of Action_IDs to initialization functions
            const actionHandlers = {
                'recan2bciV7HcjXHV': initRAGChat,         // RAG Chat Action_ID
                'reci08vuv7qfN6D84': initBusinessAnalyst, // Business Analyst Action_ID
                // Add additional Action_IDs and their handlers here
            };

            const actionHandler = actionHandlers[userData.Action_ID] || initDefaultChat;
            actionHandler(userData);

            function initSystemSupportChat(config) {
                // Code to initialize System Support chat
                console.log('System Support Chat initialized with config:', config);
                // Add your implementation here
            }

            function initRAGChat(config) {
                console.log('Initializing RAG Chat with config:', config);

                // Construct the Make.com webhook URL for RAG Chat
                const webhookUrl = `https://hook.us1.make.com/YOUR_RAG_CHAT_WEBHOOK_PATH?User_ID=${encodeURIComponent(config.User_ID)}&Org_ID=${encodeURIComponent(config.Org_ID)}&Thread_ID=${encodeURIComponent(config.Thread_ID)}&Action_ID=${encodeURIComponent(config.Action_ID)}&Source=${encodeURIComponent(config.source)}`;

                // Make the webhook call
                fetch(webhookUrl)
                    .then(response => response.json())
                    .then(data => {
                        // Handle the response
                        if (data && data.Thread_ID) {
                            console.log('Received Thread_ID:', data.Thread_ID);
                            // Continue with chat initialization using the received Thread_ID
                            initializeChatInterface(data.Thread_ID, config);
                        } else {
                            console.warn('No Thread_ID received from the webhook.');
                            // Handle this scenario appropriately
                        }
                    })
                    .catch(error => {
                        console.error('Error initializing RAG Chat:', error);
                        // Handle the error appropriately
                    });
            }

            function initBusinessAnalyst(config) {
                console.log('Initializing Business Analyst Chat with config:', config);

                // Construct the Make.com webhook URL for Business Analyst
                const webhookUrl = `https://hook.us1.make.com/YOUR_BUSINESS_ANALYST_WEBHOOK_PATH?User_ID=${encodeURIComponent(config.User_ID)}&Org_ID=${encodeURIComponent(config.Org_ID)}&Thread_ID=${encodeURIComponent(config.Thread_ID)}&Action_ID=${encodeURIComponent(config.Action_ID)}&Source=${encodeURIComponent(config.source)}`;

                // Make the webhook call
                fetch(webhookUrl)
                    .then(response => response.json())
                    .then(data => {
                        // Handle the response
                        if (data && data.Thread_ID) {
                            console.log('Received Thread_ID:', data.Thread_ID);
                            // Continue with chat initialization using the received Thread_ID
                            initializeChatInterface(data.Thread_ID, config);
                        } else {
                            console.warn('No Thread_ID received from the webhook.');
                            // Handle this scenario appropriately
                        }
                    })
                    .catch(error => {
                        console.error('Error initializing Business Analyst Chat:', error);
                        // Handle the error appropriately
                    });
            }

            function initDefaultChat(config) {
                console.log('Initializing Default Chat with config:', config);
                // Implement default chat setup here
                // Optionally, you can redirect to a default action or show a message
            }

            // Function to initialize the chat interface using the Thread_ID
            function initializeChatInterface(threadId, config) {
                // Implement your chat interface initialization here
                // This might involve rendering chat UI components, setting up connections, etc.
                console.log('Initializing chat interface with Thread_ID:', threadId);

                // Example: Redirect to the chat application with the new Thread_ID
                const chatAppUrl = `chat.html?Thread_ID=${encodeURIComponent(threadId)}&User_ID=${encodeURIComponent(config.User_ID)}&Org_ID=${encodeURIComponent(config.Org_ID)}`;
                window.location.href = chatAppUrl;
            }
        });
    </script>
</body>
</html>
